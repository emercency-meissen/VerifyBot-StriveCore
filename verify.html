<!DOCTYPE html>
<html>
<head><title>Verify</title></head>
<body>
<h2>Schritt 1: Mit Discord verbinden</h2>
<a href="/auth/discord"><button>Mit Discord verbinden</button></a>

<div id="captchaSection" style="display:none">
<h2>Schritt 2: Captcha lösen</h2>
<img id="captchaImg">
<input type="text" id="captchaInput" placeholder="Buchstaben" required>
<button id="captchaSubmit">Prüfen</button>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const discordId = urlParams.get('discordId');

if(discordId) {
    const captchaSection = document.getElementById('captchaSection');
    captchaSection.style.display = 'block';

    fetch(`/getcaptcha/${discordId}`)
        .then(res => res.json())
        .then(data => {
            document.getElementById('captchaImg').src = 'data:image/svg+xml;base64,' + btoa(data.captcha);
        });
}

document.getElementById('captchaSubmit').onclick = async () => {
    const input = document.getElementById('captchaInput').value;
    const res = await fetch('/verifycaptcha', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({discordId, input})
    });
    const data = await res.json();
    if(data.success) alert('Erfolgreich verifiziert!');
    else alert('Captcha falsch');
};
</script>
</body>
</html>
